(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{281:function(t,e,v){"use strict";v.r(e);var _=v(13),n=Object(_.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"miniextend-event"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#miniextend-event"}},[t._v("#")]),t._v(" MiniExtend Event")]),t._v(" "),e("p",[t._v("对应源文件："),e("code",[t._v("event.lua")]),t._v("、"),e("code",[t._v("ui_main.lua")]),t._v("。")]),t._v(" "),e("p",[t._v("MiniExtend Event 的前身是 "),e("code",[t._v("ScriptSupportEvent")]),t._v(" ，但更便于使用，支持 "),e("RouterLink",{attrs:{to:"/api/object.html"}},[t._v("MiniExtend Object")]),t._v(" 。")],1),t._v(" "),e("h2",{attrs:{id:"函数介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#函数介绍"}},[t._v("#")]),t._v(" 函数介绍")]),t._v(" "),e("h3",{attrs:{id:"registerevent"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#registerevent"}},[t._v("#")]),t._v(" "),e("code",[t._v("registerEvent")])]),t._v(" "),e("div",{staticClass:"language-lua extra-class"},[e("pre",{pre:!0,attrs:{class:"language-lua"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---本函数检查参数！")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@param eventname string 事件名称")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@param callback fun():any 事件触发回调")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@param uiid 如果是 UI 事件，提供界面 ID")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerEvent")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventname"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uiid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("p",[t._v("监听游戏事件，在 "),e("code",[t._v("eventname")]),t._v(" 所描述的事件发生时，回调 "),e("code",[t._v("callback")]),t._v(" 。\n返回描述事件监听的 "),e("a",{attrs:{href:"#register"}},[e("code",[t._v("Register")]),t._v(" 表")]),t._v("，用于取消事件监听。")]),t._v(" "),e("p",[t._v("如果 "),e("code",[t._v("eventname")]),t._v(" 所描述的事件为 "),e("RouterLink",{attrs:{to:"/api/document.html#UI-事件"}},[t._v("UI 事件")]),t._v("，需要指定 "),e("code",[t._v("uiid")]),t._v(" 需要监听的 UI 界面 id 。")],1),t._v(" "),e("p",[t._v("监听 UI 事件会发生预绑定，常规流程（在第 0 帧和 "),e("code",[t._v("ui_main")]),t._v(" 脚本前）不会真的监听事件，而是将信息存储在返回的 "),e("code",[t._v("Register")]),t._v(" 表中（不含 "),e("code",[t._v("id")]),t._v(" 值，暂存了临时值）。")]),t._v(" "),e("p",[t._v("在对应的 "),e("code",[t._v("ui_main")]),t._v(" 脚本执行后会完成绑定并完成 "),e("code",[t._v("Register")]),t._v(" 表（移除临时值，赋值 "),e("code",[t._v("id")]),t._v("），在中途修改返回的 "),e("code",[t._v("Register")]),t._v(" 可能导致错误。")]),t._v(" "),e("p",[t._v("该函数是 MiniExtend Event 的核心。")]),t._v(" "),e("p",[t._v("该函数的原型为 "),e("code",[t._v("ScriptSupportEvent:registerEvent")]),t._v(" 。")]),t._v(" "),e("p",[t._v("回调是以"),e("strong",[t._v("保护模式")]),t._v("运行的，如果发生错误，会输出错误信息，带上自定义的错误头。")]),t._v(" "),e("p",[t._v("回调函数调用时，还会传递一个哈希表作为参数，以下简称 "),e("code",[t._v("param")]),t._v(" ，存储着该事件发生时的一些信息。")]),t._v(" "),e("p",[e("code",[t._v("param")]),t._v(" 就是 "),e("code",[t._v("ScriptSupportEvent:registerEvent")]),t._v(" 回调函数传递的参数，详见"),e("a",{attrs:{href:"https://developers.mini1.cn/wiki/event.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[t._v("但除此之外， "),e("code",[t._v("param")]),t._v(" 还必包含一个 "),e("code",[t._v("register")]),t._v(" ，表示事件监听对应的 "),e("code",[t._v("Register")]),t._v(" 表。")]),t._v(" "),e("p",[t._v("回调函数前会提前隐式地设置 "),e("code",[t._v("objid")]),t._v(" 的值为 "),e("code",[t._v('param["eventobjd"]')]),t._v(" ，在回调结束后会恢复 "),e("code",[t._v("objid")]),t._v(" 的值。")]),t._v(" "),e("h3",{attrs:{id:"cancelregisterevent"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cancelregisterevent"}},[t._v("#")]),t._v(" "),e("code",[t._v("cancelRegisterEvent")])]),t._v(" "),e("div",{staticClass:"language-lua extra-class"},[e("pre",{pre:!0,attrs:{class:"language-lua"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@param register Register[] 需要取消的监听")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cancelRegisterEvent")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("register"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("p",[t._v("取消事件监听。")]),t._v(" "),e("h2",{attrs:{id:"自定义事件名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义事件名"}},[t._v("#")]),t._v(" 自定义事件名")]),t._v(" "),e("p",[t._v("下文将事件名称为 "),e("code",[t._v("eventname")]),t._v(" ，原始事件名称为 "),e("code",[t._v("msgStr")]),t._v(" 。")]),t._v(" "),e("p",[t._v("需要使用 "),e("code",[t._v("msgStr")]),t._v(" 作为参数调用 API ，但 MiniExtend 提供了更简短，可读性更高的自定义事件，于是就有了 "),e("code",[t._v("eventname")]),t._v(" ，它作为调用 "),e("code",[t._v("registerEvent")]),t._v(" 时实际传入的参数。")]),t._v(" "),e("p",[t._v("既可以使用 MiniExtend 自定义事件名，也可以使用 API 事件名。")]),t._v(" "),e("p",[t._v("MiniExtend 自定义事件名在 "),e("code",[t._v("event.lua")]),t._v(" 中的 "),e("code",[t._v("CustomEvents")]),t._v("（局部变量) 中定义。")]),t._v(" "),e("p",[t._v("如果 "),e("code",[t._v("eventname")]),t._v(" 以 "),e("code",[t._v('"$"')]),t._v(" 开头，则认为其为 MiniExtend 自定义事件名，否则为 API 事件名。")]),t._v(" "),e("p",[t._v("如果为 MiniExtend 自定义事件名，则 "),e("code",[t._v("msgStr = CustomEvents[eventname]")]),t._v(" 。否则，"),e("code",[t._v("msgStr = eventname")]),t._v(" 。")]),t._v(" "),e("h3",{attrs:{id:"自定义事件名-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义事件名-2"}},[t._v("#")]),t._v(" 自定义事件名")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("$ui.onShow")]),t._v("：UI 界面显示，对应 "),e("code",[t._v("UI.Show")]),t._v(" 。")]),t._v(" "),e("li",[e("code",[t._v("$ui.onHide")]),t._v("：UI 界面隐藏，对应 "),e("code",[t._v("UI.Hide")]),t._v(" 。")]),t._v(" "),e("li",[e("code",[t._v("$ui.onPress")]),t._v("：按钮按下，对应 "),e("code",[t._v("UI.Button.TouchBegin")]),t._v(" 。")]),t._v(" "),e("li",[e("code",[t._v("$ui.onClick")]),t._v("：按钮点击，对应 "),e("code",[t._v("UI.Button.Click")]),t._v(" 。")]),t._v(" "),e("li",[e("code",[t._v("$ui.onLostFocus")]),t._v("：输入框失去焦点，对应 "),e("code",[t._v("UI.LostFocus")]),t._v(" 。")])]),t._v(" "),e("p",[t._v("你会发现这些自定义事件名描述的都是 UI 事件，实际上通常通过 "),e("RouterLink",{attrs:{to:"/api/ui.html"}},[t._v("MiniExtend UI")]),t._v(" 监听这些事件。")],1),t._v(" "),e("h3",{attrs:{id:"register"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#register"}},[t._v("#")]),t._v(" "),e("code",[t._v("Register")]),e("Badge",{attrs:{text:"虚拟",type:"warning"}})],1),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("注意 "),e("code",[t._v("Register")]),t._v(" 表是 MiniExtend 理论中的一个表，"),e("code",[t._v('_GScriptFenv_["Register"]')]),t._v(" 为 "),e("code",[t._v("nil")]),t._v(" 。")])]),t._v(" "),e("p",[e("code",[t._v("Register")]),t._v(" 表是 "),e("code",[t._v("registerEvent")]),t._v(" 的返回值，用于作为 "),e("code",[t._v("cancelRegisterEvent()")]),t._v(" 的参数来取消事件监听。")]),t._v(" "),e("p",[t._v("不要修改 "),e("code",[t._v("Register")]),t._v(" 表的值，仅将整个表作为参数调用 "),e("code",[t._v("cancelRegisterEvent()")]),t._v("，以下内容只是为了方便开发者。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("成员键")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("说明")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("可读")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("可写")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("id")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("integer")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("监听实例 ID")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("√")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("uiId")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("string | nil")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("UI 界面 ID ，非 UI 事件则为 "),e("code",[t._v("nil")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("√")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("msgStr")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("string")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("API 事件名")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("√")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("callback")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("function")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("回调函数")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("预绑定时")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("eventName")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("string")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("调用时传递的 "),e("code",[t._v("eventname")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("预绑定时")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})])])]),t._v(" "),e("h2",{attrs:{id:"易混淆的事件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#易混淆的事件"}},[t._v("#")]),t._v(" 易混淆的事件")]),t._v(" "),e("p",[t._v("在按钮按下的"),e("strong",[t._v("第一帧")]),t._v("触发 "),e("code",[t._v("UI.Button.TouchBegin")]),t._v(" 事件，松开后触发 "),e("code",[t._v("UI.Button.Click")]),t._v(" 事件。")]),t._v(" "),e("p",[t._v("若按下按钮后，拖到按钮外再松开，则不视作松开，也不会触发点击事件。")]),t._v(" "),e("p",[e("code",[t._v("UI.LostFocus")]),t._v(" 可以认为是输入完成。")]),t._v(" "),e("p",[t._v("对于打开时不呼出鼠标的界面，PC 端可按下 "),e("code",[t._v("ESC")]),t._v(" 关闭，触发 "),e("code",[t._v("UI.Hide")]),t._v(" 事件。")])])}),[],!1,null,null,null);e.default=n.exports}}]);