(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{280:function(t,e,a){"use strict";a.r(e);var _=a(13),v=Object(_.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"miniextend-core"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#miniextend-core"}},[t._v("#")]),t._v(" MiniExtend Core")]),t._v(" "),e("p",[t._v("对应源文件："),e("code",[t._v("core.lua")]),t._v("。")]),t._v(" "),e("p",[t._v('MiniExtend 已尽可能恢复标准 Lua 环境，这意味着你能正常调用那些本来被"删除"的基本函数。')]),t._v(" "),e("p",[t._v("以下是相对标准 Lua 环境有所不同的部分（前提是执行了 "),e("code",[t._v("Env.__init__()")]),t._v("）：")]),t._v(" "),e("h3",{attrs:{id:"print"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#print"}},[t._v("#")]),t._v(" "),e("code",[t._v("print")])]),t._v(" "),e("div",{staticClass:"language-lua extra-class"},[e("pre",{pre:!0,attrs:{class:"language-lua"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("p",[t._v("由于控制台是不可见的，在脚本中 "),e("code",[t._v("print()")]),t._v(" 函数被重定向到日志，MiniExtend 保留了这个更改，虽然进行了重写。")]),t._v(" "),e("h3",{attrs:{id:"loadstring2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#loadstring2"}},[t._v("#")]),t._v(" "),e("code",[t._v("loadstring2")])]),t._v(" "),e("div",{staticClass:"language-lua extra-class"},[e("pre",{pre:!0,attrs:{class:"language-lua"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadstring2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("string "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" chuckname"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("p",[t._v("环境为 "),e("code",[t._v("_GScriptFenv_")]),t._v(" 的 "),e("code",[t._v("loadstring()")]),t._v(" 函数。")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("由于 "),e("code",[t._v('genv["_GScriptFenv_"]')]),t._v(" 是脚本环境，因此函数中可以通过 "),e("code",[t._v("_GScriptFenv_")]),t._v(" 访问脚本环境，从而进一步访问 MiniExtend 。")])]),t._v(" "),e("h3",{attrs:{id:"env-init"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#env-init"}},[t._v("#")]),t._v(" "),e("code",[t._v("Env.__init__")])]),t._v(" "),e("p",[t._v("初始化脚本运行环境。")]),t._v(" "),e("div",{staticClass:"language-lua extra-class"},[e("pre",{pre:!0,attrs:{class:"language-lua"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" Env"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("p",[e("strong",[t._v("在每个自定义脚本开头都要最先执行")]),t._v("，不包括 UI 作用域中的 "),e("code",[t._v("ui_main.lua")]),t._v(" ，否则可能导致脚本效率降低，出现错误。")]),t._v(" "),e("p",[t._v("（实际上就是把脚本对应的函数得环境设为 "),e("code",[t._v("_GScriptFenv_")]),t._v(" ）")]),t._v(" "),e("p",[t._v("事实上，脚本环境不是真正的 "),e("code",[t._v("_GScriptFenv_")]),t._v(" ，而是内部定义的一个表，这个表首先索引游戏 API （例如 Game 、Customui），然后才去索引 "),e("code",[t._v("_GScriptFenv_")]),t._v(" 。")]),t._v(" "),e("p",[t._v("并且每个脚本都会有不同的这样的环境，因为每个脚本都对应一个函数，而调用脚本即调用该函数，在此之前会设置环境。")]),t._v(" "),e("h3",{attrs:{id:"env-indexapi"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#env-indexapi"}},[t._v("#")]),t._v(" "),e("code",[t._v("Env.indexAPI")])]),t._v(" "),e("p",[t._v("获取游戏 API 对象，最好使用一个局部变量存储返回值。")]),t._v(" "),e("p",[t._v("函数会访问新的 "),e("code",[t._v("_GScriptFenv_")]),t._v(" ，但只应用于获取游戏 API 对象。")]),t._v(" "),e("p",[t._v("由于 "),e("code",[t._v("Env.__init__()")]),t._v(" 把脚本对应的函数的环境设为 "),e("code",[t._v("_GScriptFenv_")]),t._v(" ，因此无法直接访问游戏 API ，使用该函数访问游戏 API 。")]),t._v(" "),e("div",{staticClass:"language-lua extra-class"},[e("pre",{pre:!0,attrs:{class:"language-lua"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@param key string 访问的对象名称")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@return any 访问结果")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" Env"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexAPI")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("h3",{attrs:{id:"env-index"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#env-index"}},[t._v("#")]),t._v(" "),e("code",[t._v("Env.index")])]),t._v(" "),e("p",[t._v("使用旧的 "),e("code",[t._v("_GScriptFenv_")]),t._v("（实际上已经不存在）索引全局变量，例如脚本常量、 "),e("code",[t._v("printtag")]),t._v(" 、"),e("code",[t._v("warn")]),t._v(" 等函数。")]),t._v(" "),e("p",[t._v("这等同于以常规方式访问不为游戏 API 的全局变量。")]),t._v(" "),e("div",{staticClass:"language-lua extra-class"},[e("pre",{pre:!0,attrs:{class:"language-lua"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@param key string 索引的键")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@return any 引索结果")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" Env"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("h3",{attrs:{id:"访问范围表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#访问范围表"}},[t._v("#")]),t._v(" 访问范围表")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("方式")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[e("code",[t._v("_GScriptFenv_")]),t._v(" 中的值")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("旧的 "),e("code",[t._v("_GScriptFenv_")]),t._v(" 可访问的值")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("游戏 API")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("直接访问("),e("code",[t._v("_G")]),t._v(")")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("√")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("Env.indexAPI(key)")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("√")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("√")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[e("code",[t._v("Env.index(key)")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("√")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}})])])]),t._v(" "),e("h3",{attrs:{id:"genv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#genv"}},[t._v("#")]),t._v(" "),e("code",[t._v("genv")])]),t._v(" "),e("p",[t._v("该表表示迷你世界脚本内部环境，想知道它包含什么可以遍历它，但要注意该表包含上万个键。")]),t._v(" "),e("p",[t._v("开发者编辑的脚本的环境 "),e("code",[t._v("_GScriptFenv_")]),t._v(" 不同于 "),e("code",[t._v("genv")]),t._v(" ，但 "),e("code",[t._v('genv["_GScriptFenv_"]')]),t._v(" 就等于这个 "),e("code",[t._v("_GScriptFenv_")]),t._v(" ，也就是可以以此来通过 "),e("code",[t._v("genv")]),t._v(" 访问脚本环境。")]),t._v(" "),e("p",[t._v("在使用 "),e("code",[t._v("Env.__init__()")]),t._v(" 之前，脚本函数本身的环境是一个特殊的表，它首先控制对游戏 API 的访问，然后才去索引 "),e("code",[t._v("_GScriptFenv_")]),t._v(" 。")]),t._v(" "),e("h3",{attrs:{id:"g2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#g2"}},[t._v("#")]),t._v(" "),e("code",[t._v("_G2")])]),t._v(" "),e("p",[t._v("在任何可能的环境下(包括 "),e("code",[t._v("_GScriptFenv_")]),t._v(" 和 "),e("code",[t._v("genv")]),t._v(")，只要脚本在 "),e("code",[t._v("core")]),t._v(" 脚本后运行都可以访问该表，因此可以通过 "),e("code",[t._v("_G2")]),t._v(" 来在各个脚本之间交换数据。")]),t._v(" "),e("p",[t._v("不要使用 "),e("code",[t._v('"__MiniExtend__"')]),t._v(" 开头的变量来作为自己的索引，因为 MiniExtend 使用这种标识符作为索引存储一些变量，你可以遍历 "),e("code",[t._v("_G2")]),t._v(" 来确定 MiniExtend 使用了哪些标识符。")]),t._v(" "),e("h3",{attrs:{id:"deepcopy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deepcopy"}},[t._v("#")]),t._v(" "),e("code",[t._v("deepcopy")])]),t._v(" "),e("p",[t._v("深拷贝一个 "),e("code",[t._v("table")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language-lua extra-class"},[e("pre",{pre:!0,attrs:{class:"language-lua"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@param table table 要深拷贝的表")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("---@return table 拷贝结果")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("deepcopy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),e("p",[t._v("基本等价于 "),e("code",[t._v("copy_table(table)")]),t._v("，使用它替代 "),e("code",[t._v("copy_table")]),t._v(" 。")]),t._v(" "),e("h2",{attrs:{id:"注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),e("p",[t._v("迷你世界不是简单的 lua 解释器，有时脚本还会在服务器上运行，因此一些 lua 基本函数可能有歧义。")]),t._v(" "),e("p",[t._v("可以近似的认为开发者脚本在服务器上运行，因此 "),e("code",[t._v("io")]),t._v(", "),e("code",[t._v("package")]),t._v(", "),e("code",[t._v("os.execute")]),t._v(" 等访问操作系统的函数的行为取决于服务器。")]),t._v(" "),e("p",[t._v("对于任何访问系统的函数，例如 "),e("code",[t._v("io")]),t._v(", "),e("code",[t._v("package")]),t._v(", "),e("code",[t._v("os.execute")]),t._v(" ，它们大多本是被删除的函数和库，其行为取决于游戏的服务器。")]),t._v(" "),e("ul",[e("li",[t._v("在单人模式下，服务器就是玩家的设备。")]),t._v(" "),e("li",[t._v("由房主开启的多人游戏，服务器是房主的设备。")]),t._v(" "),e("li",[t._v("开发者申请的云服，服务器是迷你世界管理该云服的服务器（未证实）。")])]),t._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[t._v("某些基本函数可能很危险")]),t._v(" "),e("p",[t._v("必须注意这些危险行为，以下是一些例子：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("io.close()")]),t._v(" 导致"),e("span",{attrs:{title:"这似乎会使游戏保存，再次打开地图仍是玩法模式，然后继续关闭……所以请使用编辑模式打开"}},[t._v("程序突然关闭")]),t._v("。")]),t._v(" "),e("li",[t._v("在 Windows 下执行 "),e("code",[t._v('os.execute("cmd")')]),t._v(" ，会弹出一个 cmd 窗口，而且该窗口会"),e("strong",[t._v("阻塞")]),t._v("程序运行，除非手动关闭。")])])])])}),[],!1,null,null,null);e.default=v.exports}}]);